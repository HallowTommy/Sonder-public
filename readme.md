# Sonder ‚Äî Server Ops README

> –û–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è —à–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ –¥–µ–ø–ª–æ—é, —Ä—É—á–Ω–æ–º—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é –∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º –∫–æ–ø–∏—è–º –¥–ª—è VPS.

---

## üìå –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

* [–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ (UPDATE)](#-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ-update)

  * [–ë—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä](#–±—ã—Å—Ç—Ä—ã–π-–≤—Ö–æ–¥-–Ω–∞-—Å–µ—Ä–≤–µ—Ä)
  * [–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ](#–∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
  * [–†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)](#—Ä—É—á–Ω–æ–µ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ-–µ—Å–ª–∏-—Å–∫—Ä–∏–ø—Ç-–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
  * [–ú–∏–≥—Ä–∞—Ü–∏–∏, —Å—Ç–∞—Ç–∏–∫–∞, –ª–æ–≥–∏, —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å](#–º–∏–≥—Ä–∞—Ü–∏–∏-—Å—Ç–∞—Ç–∏–∫–∞-–ª–æ–≥–∏-—Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
* [–ë—ç–∫–∞–ø—ã (BACKUP)](#-–±—ç–∫–∞–ø—ã-backup)

  * [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ PowerShell –Ω–∞ VPS](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-powershell-–Ω–∞-vps)
  * [–°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤](#—Å–æ–∑–¥–∞–Ω–∏–µ-–±—ç–∫–∞–ø–æ–≤)
  * [–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–æ–≤](#–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ-–∏–∑-–±—ç–∫–∞–ø–æ–≤)
  * [–®–∞—Ä–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±—ç–∫–∞–ø–∞](#—à–∞—Ä–∞-–ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ-–±—ç–∫–∞–ø–∞)
* [–ü—Ä–∏–º–µ—á–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—á–∞–Ω–∏—è)

---

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ (UPDATE)

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ –≤ GitHub. –°–∫—Ä–∏–ø—Ç —Å—Ç—è–≥–∏–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ VPS –∏ **–ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã**. **–ë–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç –Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç.**

### –ë—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```bash
ssh root@70.34.245.3
cd /opt/Sonder
```

### –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–ó–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—è –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π (–Ω–∞—Ö–æ–¥—è—Å—å –≤ `/opt/Sonder`):

```bash
deploy
```

> –ü–æ—Ç—è–Ω–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ GitHub –∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä—ë—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã. –ë–î –æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

### –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)

1. **–ü–æ–¥—Ç—è–Ω—É—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ GitHub**

```bash
git fetch --all && git pull --ff-only
```

2. **–ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã**

```bash
docker compose build web
```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å—ë –≤ —Ñ–æ–Ω–µ**

```bash
docker compose up -d
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏, —Å—Ç–∞—Ç–∏–∫–∞, –ª–æ–≥–∏, —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

**–ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Å—Ç–∞—Ç–∏–∫–∞**

```bash
docker compose exec web python manage.py migrate
docker compose exec web python manage.py collectstatic --noinput
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏**

```bash
docker compose logs -n 120 web
```

**–°–æ–∑–¥–∞—Ç—å —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

```bash
docker compose exec web python manage.py createsuperuser
```

---

## üíæ –ë—ç–∫–∞–ø—ã (BACKUP)

–í —Å–ª—É—á–∞–µ —Å–±–æ—è –∏–ª–∏ –ø–æ–ª–Ω–æ–π –ø–æ—Ç–µ—Ä–∏ –ë–î –∏—Å–ø–æ–ª—å–∑—É–µ–º –±—ç–∫–∞–ø—ã —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã. –°–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–æ–≤ –Ω–∞–ø–∏—Å–∞–Ω –ø–æ–¥ PowerShell, –ø–æ—ç—Ç–æ–º—É –Ω–∞ VPS —Å–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PowerShell.

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PowerShell –Ω–∞ VPS

```bash
ssh root@70.34.245.3
# pass: ...

apt-get update
apt-get install -y wget apt-transport-https software-properties-common
wget -q https://packages.microsoft.com/config/ubuntu/22.04/packages-microsoft-prod.deb
dpkg -i packages-microsoft-prod.deb
apt-get update
apt-get install -y powershell

pwsh --version
```

### –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤

**–õ–æ–∫–∞–ª—å–Ω–æ (Windows PowerShell/PS7):**

```powershell
powershell -NoProfile -ExecutionPolicy Bypass -File .\scripts\local_full_backup.ps1
```

**–ù–∞ VPS:**

```bash
pwsh -NoProfile -File scripts/local_full_backup.ps1 \
  -Action Backup \
  -RetentionDays 14 \
  -ComposeFile docker-compose.yml \
  -HostMediaPath /opt/Sonder/media
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–æ–≤

**–õ–æ–∫–∞–ª—å–Ω–æ:**

```powershell
powershell -NoProfile -ExecutionPolicy Bypass -File .\scripts\local_full_backup.ps1 -Action Restore
```

**–ù–∞ VPS:**

```bash
pwsh -NoProfile -File scripts/local_full_backup.ps1 `
  -Action Restore `
  -ComposeFile docker-compose.yml `
  -HostMediaPath /opt/Sonder/media
```

### –®–∞—Ä–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±—ç–∫–∞–ø–∞

```bash
chmod 755 /opt/Sonder/scripts/share_latest_backup.sh
/opt/Sonder/scripts/share_latest_backup.sh
```

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

* –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—é—Ç —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `/opt/Sonder` –Ω–∞ VPS.
* –•—Ä–∞–Ω–∏–ª–∏—â–µ –º–µ–¥–∏–∞ –Ω–∞ VPS: `/opt/Sonder/media`.
